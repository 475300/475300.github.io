<!doctype html><html lang=zh-cn><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="ie=edge">
<title>A股年报分词找稀有概念[未完成] - 乐土为家</title>
<meta name=description content="a 股 2020年半年报营收xx亿，稀有概念创造的收入占x%，创造的净利润是xx，创造的营收是xx，是否因为疫情影响，是否有持续性和复制性等等 类">
<link rel=canonical href=https://475300.github.io/%E4%BA%A4%E6%98%93/a%E8%82%A1%E5%B9%B4%E6%8A%A5%E5%88%86%E8%AF%8D%E6%89%BE%E7%A8%80%E6%9C%89%E6%A6%82%E5%BF%B5%E6%9C%AA%E5%AE%8C%E6%88%90/>
<meta property="og:title" content="A股年报分词找稀有概念[未完成]">
<meta property="og:type" content="article">
<meta property="og:url" content="https://475300.github.io/%E4%BA%A4%E6%98%93/a%E8%82%A1%E5%B9%B4%E6%8A%A5%E5%88%86%E8%AF%8D%E6%89%BE%E7%A8%80%E6%9C%89%E6%A6%82%E5%BF%B5%E6%9C%AA%E5%AE%8C%E6%88%90/">
<meta property="og:description" content="a 股 2020年半年报营收xx亿，稀有概念创造的收入占x%，创造的净利润是xx，创造的营收是xx，是否因为疫情影响，是否有持续性和复制性等等 类">
<meta property="og:site_name" content="乐土为家">
<link rel=stylesheet href=https://475300.github.io/css/main.min.46626abaa02257c4c323c7d2f1f872e4a75032f4ab4bea8ceb62daf52bfc81a2.css integrity="sha256-RmJquqAiV8TDI8fS8fhy5KdQMvSrS+qM62La9Sv8gaI=">
<meta name=generator content="Hugo 0.86.1">
<script type=module src=https://unpkg.com/ionicons@5.1.2/dist/ionicons/ionicons.esm.js></script>
<script nomodule src=https://unpkg.com/ionicons@5.1.2/dist/ionicons/ionicons.js></script>
</head>
<body><header class=site-header>
<nav class=site-nav role=navigation aria-label=breadcrumb>
<ol itemscope itemtype=https://schema.org/BreadcrumbList class=breadcrumb><li class=breadcrumb-item itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem>
<a itemtype=https://schema.org/Thing itemprop=item href=https://475300.github.io/>
<span itemprop=name>乐土为家</span>
</a>
<meta itemprop=position content="0">
</li>/<li class=breadcrumb-item itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem>
<a itemtype=https://schema.org/Thing itemprop=item href=https://475300.github.io/%E4%BA%A4%E6%98%93/>
<span itemprop=name>交易</span>
</a>
<meta itemprop=position content="0">
</li>/<li class="breadcrumb-item active hidden" aria-current=page itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem>
<a itemtype=https://schema.org/Thing itemprop=item href=https://475300.github.io/%E4%BA%A4%E6%98%93/a%E8%82%A1%E5%B9%B4%E6%8A%A5%E5%88%86%E8%AF%8D%E6%89%BE%E7%A8%80%E6%9C%89%E6%A6%82%E5%BF%B5%E6%9C%AA%E5%AE%8C%E6%88%90/>
<span itemprop=name>A股年报分词找稀有概念[未完成]</span>
</a>
<meta itemprop=position content="1">
</li></ol>
</nav>
<h1 class="site-title hidden">
<a href=https://475300.github.io/>乐土为家</a>
</h1>
</header>
<main id=content>
<article role=article class="content post h-entry" itemscope itemtype=http://schema.org/BlogPosting>
<header class=post-header>
<h2 class=post-title itemprop="name headline">A股年报分词找稀有概念[未完成]</h2>
<span class=post-meta>
<time class=date-published datetime=2020-10-09T19:15:00+07:00 itemprop=datePublished>
2020.10.9，星期五
</time>
<span>
<ul id=authors>
<li> <a href=https://475300.github.io/authors/enel>@enel</a> </li>
</ul>
<ul id=tags>
<li> <a href=https://475300.github.io/tags/%E7%9B%92%E9%A5%AD%E7%BE%A4%E4%BD%9C%E4%B8%9A>#盒饭群作业</a> </li>
<li> <a href=https://475300.github.io/tags/todo>#todo</a> </li>
</ul>
</span>
</span>
</header>
<div class=post-content itemprop=articleBody>
<blockquote>
<blockquote>
<p>a 股</p>
<p>2020年半年报营收xx亿，稀有概念创造的收入占x%，创造的净利润是xx，创造的营收是xx，是否因为疫情影响，是否有持续性和复制性等等</p>
</blockquote>
<p>类似这样</p>
</blockquote>
<p>盒饭群九月底要交的作业，每人从A股里找10个概念稀缺的股票。</p>
<h2 id=思路>思路</h2>
<p><strong>抓取所有A股最近的半年报告，分词，去重、留下业务相关的名词，统计该股半年报中每个词出现在几个股票的半年报中。</strong></p>
<p>出现次数少的业务名词可能就是稀缺概念，挨个研究。</p>
<h2 id=找所有a股的代码>找所有A股的代码</h2>
<p>随便找了<a href=http://www.shdjt.com/js/lib/astock.js target=_blank rel="nofollow noreferrer noopener">一个</a>。</p>
<h2 id=抓年报>抓年报</h2>
<p>新浪财经有各股票的半年报列表，以人福药业（600079）为例：<code>http://money.finance.sina.com.cn/corp/go.php/vCB_Bulletin/stockid/600079/page_type/ndbg.phtml</code>，替换<code>600079</code>就能得到其它股票的半年报列表。</p>
<p>用<a href=https://github.com/binux/pyspider target=_blank rel="nofollow noreferrer noopener">pyspider</a>把所有股票这个列表的第一条里的半年报全爬了。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#!/usr/bin/env python</span>
<span style=color:#75715e># -*- encoding: utf-8 -*-</span>
<span style=color:#75715e># Created on 2020-09-28 13:44:18</span>
<span style=color:#75715e># Project: hefan</span>

<span style=color:#f92672>from</span> pyspider.libs.base_handler <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Handler</span>(BaseHandler):
    crawl_config <span style=color:#f92672>=</span> {
    }

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>on_start</span>(self):
        symbols <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;300001&#39;</span>, <span style=color:#e6db74>&#39;300002&#39;</span>]  <span style=color:#75715e># 要爬的股票代码贴这儿。</span>
        <span style=color:#66d9ef>for</span> s <span style=color:#f92672>in</span> symbols:
            self<span style=color:#f92672>.</span>crawl(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;http://vip.stock.finance.sina.com.cn/corp/go.php/vCB_Bulletin/stockid/</span><span style=color:#e6db74>{</span>s<span style=color:#e6db74>}</span><span style=color:#e6db74>/page_type/ndbg.phtml&#39;</span>, callback<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>index_page)

    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>index_page</span>(self, response):
        self<span style=color:#f92672>.</span>crawl(response<span style=color:#f92672>.</span>doc(<span style=color:#e6db74>&#39;.datelist &gt; ul &gt; a&#39;</span>)<span style=color:#f92672>.</span>attr<span style=color:#f92672>.</span>href, callback<span style=color:#f92672>=</span>self<span style=color:#f92672>.</span>detail_page)

    <span style=color:#a6e22e>@config</span>(priority<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>)
    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>detail_page</span>(self, response):
        <span style=color:#66d9ef>return</span> {
            <span style=color:#e6db74>&#34;url&#34;</span>: response<span style=color:#f92672>.</span>url,
            <span style=color:#e6db74>&#34;title&#34;</span>: response<span style=color:#f92672>.</span>doc(<span style=color:#e6db74>&#39;#allbulletin &gt; thead &gt; tr &gt; th&#39;</span>)<span style=color:#f92672>.</span>text(),
            <span style=color:#e6db74>&#34;content&#34;</span>: response<span style=color:#f92672>.</span>doc(<span style=color:#e6db74>&#39;#content&#39;</span>)<span style=color:#f92672>.</span>text(),
        }
</code></pre></div><h2 id=分词>分词</h2>
<ul>
<li><del><a href=https://github.com/fxsjy/jieba target=_blank rel="nofollow noreferrer noopener">结巴中文分词</a></del> → 效果不好</li>
<li><del><a href=http://api.pullword.com/ target=_blank rel="nofollow noreferrer noopener">pullword</a></del> → 效果最好，但api有限制，也不稳定。</li>
<li><a href=https://github.com/hankcs/HanLP target=_blank rel="nofollow noreferrer noopener">HanLP</a> ✓</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> hanlp
<span style=color:#f92672>import</span> json

tokenizer <span style=color:#f92672>=</span> hanlp<span style=color:#f92672>.</span>load(<span style=color:#e6db74>&#39;LARGE_ALBERT_BASE&#39;</span>)
tagger <span style=color:#f92672>=</span> hanlp<span style=color:#f92672>.</span>load(hanlp<span style=color:#f92672>.</span>pretrained<span style=color:#f92672>.</span>pos<span style=color:#f92672>.</span>CTB5_POS_RNN_FASTTEXT_ZH)

pipeline <span style=color:#f92672>=</span> hanlp<span style=color:#f92672>.</span>pipeline()\
    <span style=color:#f92672>.</span>append(hanlp<span style=color:#f92672>.</span>utils<span style=color:#f92672>.</span>rules<span style=color:#f92672>.</span>split_sentence, output_key<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;sentences&#39;</span>)\
    <span style=color:#f92672>.</span>append(tokenizer, output_key<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;tokens&#39;</span>)\
    <span style=color:#f92672>.</span>append(tagger, output_key<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;part_of_speech_tags&#39;</span>)

<span style=color:#75715e># 1. 筛名词</span>
<span style=color:#75715e># NN 普通名词，NR 专有名词</span>
<span style=color:#75715e># 2. 名词去重</span>
<span style=color:#75715e># 3. ｛&#34;002468&#34;:[&#34;枸橼酸芬太尼&#34;, &#34;枸橼酸舒芬太尼&#34;, &#34;注射液&#34;]}</span>
<span style=color:#75715e># 4. 查某一名词出现在了几只股票里。</span>

<span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;C:</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>Users</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>-</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>Desktop</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>hefan</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>hanlp</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>hefan_300xxx.json&#39;</span>, encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;utf-8&#39;</span>) <span style=color:#66d9ef>as</span> f1, open(<span style=color:#e6db74>&#39;C:</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>Users</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>-</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>Desktop</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>hefan</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>hanlp</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>hefan_300xxx_parsed.txt&#39;</span>, <span style=color:#e6db74>&#39;a&#39;</span>, encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;utf-8&#39;</span>) <span style=color:#66d9ef>as</span> f2:
    <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> f1:
        code <span style=color:#f92672>=</span> line[<span style=color:#ae81ff>136</span>:<span style=color:#ae81ff>142</span>]    <span style=color:#75715e># 股票代码</span>
        doc <span style=color:#f92672>=</span> pipeline(line)
        tokens <span style=color:#f92672>=</span> doc<span style=color:#f92672>.</span>to_dict()[<span style=color:#e6db74>&#34;tokens&#34;</span>]
        part_of_speech_tags <span style=color:#f92672>=</span> doc<span style=color:#f92672>.</span>to_dict()[<span style=color:#e6db74>&#34;part_of_speech_tags&#34;</span>]

        tmp_tokens <span style=color:#f92672>=</span> []
        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(len(tokens)):
            <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(len(tokens[i])):
                <span style=color:#66d9ef>if</span>(part_of_speech_tags[i][j] <span style=color:#f92672>in</span> [<span style=color:#e6db74>&#34;NN&#34;</span>, <span style=color:#e6db74>&#34;NR&#34;</span>]):
                    tmp_tokens<span style=color:#f92672>.</span>append(tokens[i][j])

        tokens <span style=color:#f92672>=</span> list(set(tmp_tokens))  <span style=color:#75715e># 去重</span>
        f2<span style=color:#f92672>.</span>write(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>code<span style=color:#e6db74>}</span><span style=color:#e6db74>-&#34;</span><span style=color:#f92672>+</span><span style=color:#e6db74>&#34;,&#34;</span><span style=color:#f92672>.</span>join(tokens)<span style=color:#f92672>+</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</code></pre></div><p>要安装cuda和cudnn。</p>
<h2 id=todo>TODO</h2>
<ul>
<li>换显卡后再做。</li>
</ul>
<hr>
<ul>
<li>docker 省事。</li>
<li>分词真慢。代码是<code>688xxx</code>的股票的半年报文本有35.8M，分词+去重用了5小时45分钟。其余的半年报文本有1361M。
<ul>
<li>E3-1231v3 GTX970 8Gx2</li>
<li>cuda 10.1.243, cudnn 7.6.5.32</li>
</ul>
</li>
</ul>
</div>
</article>
<div class=pagination>
<div class=prev> <a href=https://475300.github.io/%E4%BA%A4%E6%98%93/coinbase-pro%E4%B8%8A%E5%B8%81%E5%89%8D%E5%90%8E%E4%BB%B7%E6%A0%BC%E5%8F%98%E5%8C%96/>Previous Post</a> </div>
<div class=next> <a href=https://475300.github.io/%E4%BA%A4%E6%98%93/%E6%AF%94%E7%89%B9%E5%B8%81%E4%B8%8E%E5%90%84%E8%82%A1%E5%B8%82%E5%B8%82%E5%80%BC%E6%AF%94%E8%BE%83/>Next Post</a> </div>
</div>
</main><footer class=site-footer>
<span class=left>
<a href=/authors>Authors</a>
.
<a href=/tags>Tags</a>
</span>
<span class=right>
<em>乐土为家</em>
</span>
</footer>
</body>
</html>