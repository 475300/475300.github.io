<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>灰度持仓数据分析 - 乐土为家</title><meta name=description content="灰度官方没有持仓曲线的数据，但会在推特上以图片方式更新其管理的净资产规模（Net Assets Under Management)。从2018年3月6日至今。
所以要：
 下载所有图片 OCR 检查数据（有无减仓）  下载有数据的图片图片 用谷歌浏览器在推特上搜索from:grayscale Net Assets Under Management，然后按“最新”。 或者直接点这里。
按F12打开开发者工具，选中“Network”，过滤出“adaptive.json”，清空网络请求记录，刷新当前页面，此时网络请求记录里就有一条请求了。右键“Copy - copy response”将记录了存在别处，这个response里有当前页面中图片的url。
向下滚动页面拿到所有数据，然后下载图片。
# 下载图片 import json import requests import datetime with open('responses.txt') as f: for line in f: tweets = json.loads(line)[&#34;globalObjects&#34;][&#34;tweets&#34;] for _, value in tweets.items(): date = value[&#34;full_text&#34;][0:8].split()[0] # 11/12/20 date_s = date.split('/') date = datetime.datetime(int(&#34;20&#34;+date_s[2]), int(date_s[0]), int(date_s[1])).strftime(&#34;%Y%m%d&#34;) # 20201112 img_url = value[&#34;entities&#34;][&#34;media&#34;][0][&#34;media_url&#34;] ext = img_url.rsplit('.', 1)[1] filename = f&#34;{date}."><link rel=canonical href=https://475300.github.io/%E4%BA%A4%E6%98%93/%E7%81%B0%E5%BA%A6%E6%AF%94%E7%89%B9%E5%B8%81%E6%8C%81%E4%BB%93%E5%88%86%E6%9E%90/><meta property="og:title" content="灰度持仓数据分析"><meta property="og:type" content="article"><meta property="og:url" content="https://475300.github.io/%E4%BA%A4%E6%98%93/%E7%81%B0%E5%BA%A6%E6%AF%94%E7%89%B9%E5%B8%81%E6%8C%81%E4%BB%93%E5%88%86%E6%9E%90/"><meta property="og:description" content="灰度官方没有持仓曲线的数据，但会在推特上以图片方式更新其管理的净资产规模（Net Assets Under Management)。从2018年3月6日至今。
所以要：
 下载所有图片 OCR 检查数据（有无减仓）  下载有数据的图片图片 用谷歌浏览器在推特上搜索from:grayscale Net Assets Under Management，然后按“最新”。 或者直接点这里。
按F12打开开发者工具，选中“Network”，过滤出“adaptive.json”，清空网络请求记录，刷新当前页面，此时网络请求记录里就有一条请求了。右键“Copy - copy response”将记录了存在别处，这个response里有当前页面中图片的url。
向下滚动页面拿到所有数据，然后下载图片。
# 下载图片 import json import requests import datetime with open('responses.txt') as f: for line in f: tweets = json.loads(line)[&#34;globalObjects&#34;][&#34;tweets&#34;] for _, value in tweets.items(): date = value[&#34;full_text&#34;][0:8].split()[0] # 11/12/20 date_s = date.split('/') date = datetime.datetime(int(&#34;20&#34;+date_s[2]), int(date_s[0]), int(date_s[1])).strftime(&#34;%Y%m%d&#34;) # 20201112 img_url = value[&#34;entities&#34;][&#34;media&#34;][0][&#34;media_url&#34;] ext = img_url.rsplit('.', 1)[1] filename = f&#34;{date}."><meta property="og:site_name" content="乐土为家"><link rel=stylesheet href=https://475300.github.io/css/main.min.0b50515547f50b919e79f82174b97c08d446b5f870c1dcde90711df0d3c494c7.css integrity="sha256-C1BRVUf1C5GeefghdLl8CNRGtfhwwdzekHEd8NPElMc="><meta name=generator content="Hugo 0.74.3"><script type=module src=https://unpkg.com/ionicons@5.1.2/dist/ionicons/ionicons.esm.js></script><script nomodule src=https://unpkg.com/ionicons@5.1.2/dist/ionicons/ionicons.js></script></head><body><header class=site-header><nav class=site-nav role=navigation aria-label=breadcrumb><ol itemscope itemtype=https://schema.org/BreadcrumbList class=breadcrumb><li class=breadcrumb-item itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemtype=https://schema.org/Thing itemprop=item href=https://475300.github.io/><span itemprop=name>乐土为家</span></a><meta itemprop=position content="0"></li>/<li class=breadcrumb-item itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemtype=https://schema.org/Thing itemprop=item href=https://475300.github.io/%E4%BA%A4%E6%98%93/><span itemprop=name>交易</span></a><meta itemprop=position content="0"></li>/<li class="breadcrumb-item active hidden" aria-current=page itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a itemtype=https://schema.org/Thing itemprop=item href=https://475300.github.io/%E4%BA%A4%E6%98%93/%E7%81%B0%E5%BA%A6%E6%AF%94%E7%89%B9%E5%B8%81%E6%8C%81%E4%BB%93%E5%88%86%E6%9E%90/><span itemprop=name>灰度持仓数据分析</span></a><meta itemprop=position content="1"></li></ol></nav><h1 class="site-title hidden"><a href=https://475300.github.io/>乐土为家</a></h1></header><main id=content><article role=article class="content post h-entry" itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h2 class=post-title itemprop="name headline">灰度持仓数据分析</h2><span class=post-meta><time class=date-published datetime=2020-11-19T19:39:00+07:00 itemprop=datePublished>2020.11.19，星期四</time></span></header><div class=post-content itemprop=articleBody><p>灰度官方没有持仓曲线的数据，但会在推特上以图片方式更新其管理的净资产规模（Net Assets Under Management)。从2018年3月6日至今。</p><p>所以要：</p><ul><li><input checked disabled type=checkbox> 下载所有图片</li><li><input checked disabled type=checkbox> OCR</li><li><input checked disabled type=checkbox> 检查数据（有无减仓）</li></ul><h2 id=下载有数据的图片图片>下载有数据的图片图片</h2><p>用谷歌浏览器在推特上搜索<code>from:grayscale Net Assets Under Management</code>，然后按“最新”。 或者直接点<a href="https://twitter.com/search?q=from%3Agrayscale%20Net%20Assets%20Under%20Management&src=typed_query&f=live" target=_blank rel="nofollow noreferrer noopener">这里</a>。</p><p>按F12打开开发者工具，选中“Network”，过滤出“adaptive.json”，清空网络请求记录，刷新当前页面，此时网络请求记录里就有一条请求了。右键“Copy - copy response”将记录了存在别处，这个response里有当前页面中图片的url。</p><p>向下滚动页面拿到所有数据，然后下载图片。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># 下载图片</span>
<span style=color:#f92672>import</span> json
<span style=color:#f92672>import</span> requests
<span style=color:#f92672>import</span> datetime

<span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;responses.txt&#39;</span>) <span style=color:#66d9ef>as</span> f:
    <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> f:
        tweets <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>loads(line)[<span style=color:#e6db74>&#34;globalObjects&#34;</span>][<span style=color:#e6db74>&#34;tweets&#34;</span>]
        <span style=color:#66d9ef>for</span> _, value <span style=color:#f92672>in</span> tweets<span style=color:#f92672>.</span>items():
            date <span style=color:#f92672>=</span> value[<span style=color:#e6db74>&#34;full_text&#34;</span>][<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>8</span>]<span style=color:#f92672>.</span>split()[<span style=color:#ae81ff>0</span>]   <span style=color:#75715e># 11/12/20</span>
            date_s <span style=color:#f92672>=</span> date<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;/&#39;</span>)
            date <span style=color:#f92672>=</span> datetime<span style=color:#f92672>.</span>datetime(int(<span style=color:#e6db74>&#34;20&#34;</span><span style=color:#f92672>+</span>date_s[<span style=color:#ae81ff>2</span>]), int(date_s[<span style=color:#ae81ff>0</span>]), int(date_s[<span style=color:#ae81ff>1</span>]))<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;%Y%m</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>) <span style=color:#75715e># 20201112</span>
            img_url <span style=color:#f92672>=</span> value[<span style=color:#e6db74>&#34;entities&#34;</span>][<span style=color:#e6db74>&#34;media&#34;</span>][<span style=color:#ae81ff>0</span>][<span style=color:#e6db74>&#34;media_url&#34;</span>]
            ext <span style=color:#f92672>=</span> img_url<span style=color:#f92672>.</span>rsplit(<span style=color:#e6db74>&#39;.&#39;</span>, <span style=color:#ae81ff>1</span>)[<span style=color:#ae81ff>1</span>]
            filename <span style=color:#f92672>=</span> f<span style=color:#e6db74>&#34;{date}.{ext}&#34;</span>

            <span style=color:#66d9ef>print</span>(f<span style=color:#e6db74>&#34;{date} - {img_url}&#34;</span>)
            <span style=color:#66d9ef>print</span>(filename)
            <span style=color:#66d9ef>with</span> open(filename, <span style=color:#e6db74>&#39;wb&#39;</span>) <span style=color:#66d9ef>as</span> handle:    <span style=color:#75715e># download image</span>
                    response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(img_url, stream<span style=color:#f92672>=</span>True)
                    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> response<span style=color:#f92672>.</span>ok:
                        <span style=color:#66d9ef>print</span>(response)
                    <span style=color:#66d9ef>for</span> block <span style=color:#f92672>in</span> response<span style=color:#f92672>.</span>iter_content(<span style=color:#ae81ff>1024</span>):
                        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> block:
                            <span style=color:#66d9ef>break</span>
                        handle<span style=color:#f92672>.</span>write(block)
</code></pre></div><h2 id=ocr>OCR</h2><p>用<a href=https://github.com/JaidedAI/EasyOCR target=_blank rel="nofollow noreferrer noopener">easyOCR</a>处理图片，得到csv。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> os<span style=color:#f92672>,</span> re
<span style=color:#f92672>import</span> easyocr

<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>find_box</span>(date):
    <span style=color:#e6db74>&#34;&#34;&#34;
</span><span style=color:#e6db74>    不同样式的图片，目标文字的位置不同。
</span><span style=color:#e6db74>    样式乱七八糟的，艹。
</span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
    <span style=color:#66d9ef>return</span> [(<span style=color:#ae81ff>440</span>, <span style=color:#ae81ff>510</span>, <span style=color:#ae81ff>150</span>, <span style=color:#ae81ff>165</span>)] <span style=color:#66d9ef>if</span> <span style=color:#ae81ff>20181211</span><span style=color:#f92672>&lt;=</span>date<span style=color:#f92672>&lt;=</span><span style=color:#ae81ff>20181218</span> <span style=color:#66d9ef>else</span>\
        [(<span style=color:#ae81ff>440</span>, <span style=color:#ae81ff>510</span>, <span style=color:#ae81ff>130</span>, <span style=color:#ae81ff>145</span>)] <span style=color:#66d9ef>if</span> <span style=color:#ae81ff>20191028</span><span style=color:#f92672>&lt;=</span>date<span style=color:#f92672>&lt;=</span><span style=color:#ae81ff>20191119</span> <span style=color:#66d9ef>else</span>\
        [(<span style=color:#ae81ff>750</span>, <span style=color:#ae81ff>870</span>, <span style=color:#ae81ff>220</span>, <span style=color:#ae81ff>245</span>)] <span style=color:#66d9ef>if</span> date<span style=color:#f92672>==</span><span style=color:#ae81ff>20191017</span> <span style=color:#66d9ef>else</span>\
        \
        [(<span style=color:#ae81ff>890</span>, <span style=color:#ae81ff>1065</span>, <span style=color:#ae81ff>105</span>, <span style=color:#ae81ff>140</span>)] <span style=color:#66d9ef>if</span> date<span style=color:#f92672>&lt;=</span><span style=color:#ae81ff>20180329</span> <span style=color:#66d9ef>else</span>\
        [(<span style=color:#ae81ff>925</span>, <span style=color:#ae81ff>1080</span>, <span style=color:#ae81ff>325</span>, <span style=color:#ae81ff>360</span>)] <span style=color:#66d9ef>if</span> date<span style=color:#f92672>&lt;=</span><span style=color:#ae81ff>20190116</span> <span style=color:#66d9ef>else</span> \
        [(<span style=color:#ae81ff>925</span>, <span style=color:#ae81ff>1080</span>, <span style=color:#ae81ff>310</span>, <span style=color:#ae81ff>340</span>)] <span style=color:#66d9ef>if</span> date<span style=color:#f92672>&lt;=</span><span style=color:#ae81ff>20190208</span> <span style=color:#66d9ef>else</span> \
        [(<span style=color:#ae81ff>925</span>, <span style=color:#ae81ff>1080</span>, <span style=color:#ae81ff>285</span>, <span style=color:#ae81ff>315</span>)] <span style=color:#66d9ef>if</span> date<span style=color:#f92672>&lt;=</span><span style=color:#ae81ff>20190625</span> <span style=color:#66d9ef>else</span> \
        [(<span style=color:#ae81ff>775</span>, <span style=color:#ae81ff>900</span>, <span style=color:#ae81ff>230</span>, <span style=color:#ae81ff>255</span>)] <span style=color:#66d9ef>if</span> date<span style=color:#f92672>&lt;=</span><span style=color:#ae81ff>20191213</span> <span style=color:#66d9ef>else</span> \
        [(<span style=color:#ae81ff>410</span>, <span style=color:#ae81ff>530</span>, <span style=color:#ae81ff>270</span>, <span style=color:#ae81ff>300</span>)]

reader <span style=color:#f92672>=</span> easyocr<span style=color:#f92672>.</span>Reader([<span style=color:#e6db74>&#39;en&#39;</span>])
<span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#34;aum.csv&#34;</span>, <span style=color:#e6db74>&#39;a&#39;</span>) <span style=color:#66d9ef>as</span> f:
    <span style=color:#66d9ef>for</span> entry <span style=color:#f92672>in</span> os<span style=color:#f92672>.</span>scandir(<span style=color:#e6db74>&#39;images&#39;</span>):
        date <span style=color:#f92672>=</span> entry<span style=color:#f92672>.</span>name<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;.&#39;</span>)[<span style=color:#ae81ff>0</span>]
        box <span style=color:#f92672>=</span> find_box(int(date))
        result <span style=color:#f92672>=</span> reader<span style=color:#f92672>.</span>recognize(entry<span style=color:#f92672>.</span>path, box, [], detail<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, allowlist<span style=color:#f92672>=</span>set(<span style=color:#e6db74>&#34;0123456789.,$M&#34;</span>))
        aum <span style=color:#f92672>=</span> result[<span style=color:#ae81ff>0</span>]<span style=color:#f92672>.</span>strip()
        <span style=color:#75715e># 修正部分识别错误</span>
        aum <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>findall(<span style=color:#e6db74>r</span><span style=color:#e6db74>&#34;\$(.+?)M&#34;</span>, aum)[<span style=color:#ae81ff>0</span>]
        aum <span style=color:#f92672>=</span> aum<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;.&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)
        aum <span style=color:#f92672>=</span> aum<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;,&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)
        p_index <span style=color:#f92672>=</span> len(aum) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
        aum <span style=color:#f92672>=</span> aum[:p_index]<span style=color:#f92672>+</span><span style=color:#e6db74>&#39;.&#39;</span><span style=color:#f92672>+</span>aum[p_index:]

        row <span style=color:#f92672>=</span> f<span style=color:#e6db74>&#34;{date}</span><span style=color:#ae81ff>\t</span><span style=color:#e6db74>{aum}&#34;</span> 
        f<span style=color:#f92672>.</span>write(row<span style=color:#f92672>+</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
        <span style=color:#66d9ef>print</span>(f<span style=color:#e6db74>&#34;{row}</span><span style=color:#ae81ff>\t</span><span style=color:#e6db74>{box}&#34;</span>)

</code></pre></div><p>可能还有识别错误，检查一下手动改。</p><h2 id=检查数据有无减仓>检查数据（有无减仓）</h2><p>尴尬了。</p><p>AUM（Net Assets Under Management）可能并不是比特币持仓价值。</p><p>AICoin计算的是<code>流通股*每股比特币量</code><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>，所得结果与AUM除以当日比特币收盘价不同。不懂为什么，但用“流通”股应该是错的。</p><p><img src=/img/2020-11-19-AUM%5B20180306-20201118%5D.png alt=2020-11-19-AUM[20180306-20201118]></p><h3 id=用aum计算比特币数量>用AUM计算比特币数量</h3><p>用Coinbase Pro的<a href="https://docs.pro.coinbase.com/?r=1#get-historic-rates" target=_blank rel="nofollow noreferrer noopener">API</a>获取20180306以来的所有日线收盘价，然后过滤出与AUM对应的，添加到之前的csv文件中。</p><p>每次最多获取300天数据，用postman手动多请求几次拼成一个数组。用下面的脚本向csv中添加收盘价。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> json
<span style=color:#f92672>from</span> datetime <span style=color:#f92672>import</span> date

<span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;candles.json&#39;</span>, <span style=color:#e6db74>&#39;r&#39;</span>) <span style=color:#66d9ef>as</span> f:
    candles <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>load(f)
    prices <span style=color:#f92672>=</span> {}
    <span style=color:#66d9ef>for</span> k <span style=color:#f92672>in</span> candles:
        d <span style=color:#f92672>=</span> date<span style=color:#f92672>.</span>fromtimestamp(int(k[<span style=color:#ae81ff>0</span>]))<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;%Y%m</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>)
        prices[d] <span style=color:#f92672>=</span> k[<span style=color:#ae81ff>4</span>]

<span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;aum.csv&#39;</span>) <span style=color:#66d9ef>as</span> f:
    aum_lines <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>readlines()
<span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;aum.csv&#39;</span>, <span style=color:#e6db74>&#39;w&#39;</span>) <span style=color:#66d9ef>as</span> f:
    <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> aum_lines:
        line <span style=color:#f92672>=</span> line<span style=color:#f92672>.</span>strip(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
        date <span style=color:#f92672>=</span> line<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\t</span><span style=color:#e6db74>&#39;</span>)[<span style=color:#ae81ff>0</span>]
        price <span style=color:#f92672>=</span> prices[date]
        f<span style=color:#f92672>.</span>write(f<span style=color:#e6db74>&#34;{line}</span><span style=color:#ae81ff>\t</span><span style=color:#e6db74>{price}</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
        <span style=color:#66d9ef>print</span>(f<span style=color:#e6db74>&#34;{line}</span><span style=color:#ae81ff>\t</span><span style=color:#e6db74>{price}&#34;</span>)
</code></pre></div><p><img src=/img/2020-11-19-%E6%8C%89AUM%E8%AE%A1%E7%AE%97%E5%BE%97%E5%88%B0%E7%9A%84%E6%AF%94%E7%89%B9%E5%B8%81%E6%95%B0%E9%87%8F.png alt=2020-11-19-按AUM计算得到的比特币数量></p><p><strong>图中红线部分持仓明显下降，灰度并非不会砸。</strong></p><hr><p><a href=https://grayscale.co/wp-content/uploads/2020/11/BTC-Trust-Fact-Sheet-November-2020.pdf target=_blank rel="nofollow noreferrer noopener">Grayscale Bitcoin Trust Fact Sheet</a> 中关于赎回规则的描述 ↓</p><p><img src=/img/2020-11-19-%E8%B5%8E%E5%9B%9E%E8%A7%84%E5%88%99.png alt=赎回规则></p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>用官网<a href=https://grayscale.co/bitcoin-investment-trust/#overview target=_blank rel="nofollow noreferrer noopener">这里</a>的“Shares Outstanding”乘“Bitcoin per Share”。 <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></article><div class=pagination><div class=prev><a href=https://475300.github.io/%E4%BA%A4%E6%98%93/%E4%BA%A4%E6%98%93%E4%BB%8E%E4%BA%8F%E6%8D%9F%E5%88%B0%E7%9B%88%E5%88%A9%E6%9C%80%E9%9C%80%E8%A6%81%E4%BB%80%E4%B9%88%E5%A6%82%E4%BD%95%E6%89%8D%E8%83%BD%E5%A4%9F%E5%81%9A%E5%88%B0-553/>Previous Post</a></div></div></main><footer class=site-footer><span class=left>Gohugo/0.74.3</span>
<span class=right><em>乐土为家</em></span></footer></body></html>